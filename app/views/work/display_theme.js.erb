//get data from controller
var imageData = '<%= raw @image_data %>';
var valuesQty = '<%= @image_data[:values_qty] %>';
$('.left_controls span.total_values h2.total').append().html(valuesQty);

//show theme
var selectedTheme = '<%= @image_data[:theme] %>';

if( selectedTheme == "Выберите тему для оценки" || selectedTheme == "Select theme to leave your answer"  || selectedTheme == "" ){
  $('.img-left-side').css({"display": "none"});
  $('.img-right-side').css({"display": "none"});
  $('.image .image_display .image_diag').css({"display": "none"});
}
else {
  $('.img-left-side').css({"display": "block"});
  $('.img-right-side').css({"display": "block"});
  $('.image .image_display .image_diag').css({"display": "block"});
}

$('.image_display h2.up-theme').append().html(selectedTheme);

//restore button
$('.select_theme').empty().html("<%= j render 'work/button_theme_select' -%>");

//get data from controller
var imageCurrentIndex = '<%= @image_data[:index] %>';

//var firstThemeImagesName = JSON.parse(firstThemeImages)["name"];
var oneImageName = '<%= @image_data[:name] %>';
var oneImageFile = '<%= @image_data[:file] %>';
var oneImageId = '<%= @image_data[:image_id] %>';
var themeImageSize = '<%= @image_data[:image_arr_size] %>';
var selectedThemeId = '<%= @image_data[:theme_id] %>';

//show name of image
//var nameImage = selectedImage.slice(0,-4) ;  // put away . file .jpr
$('.image_display h2.up').append().html(oneImageName);

//show image
var pathImage = "assets/pictures/" + oneImageFile;

// $('.img-center').html('<img alt="Selected Image" src="'+ pathImage + '"/>');
$(".img-center").attr({title: "Selected image" });
$(".img-center img").attr({alt: "Selected Image", src: pathImage, title: "Selected image" });

//API
$('.img-right-side').click(function(event) {
  event.stopImmediatePropagation(); // would stop the event from bubbling to parent elements,
  $.ajax({
    type: "get",
    url: "api/next_image",
    data: { index: imageCurrentIndex,
      theme_id: selectedThemeId,
      length: themeImageSize},
    dataType: 'json'
  }).done(function (data_return){
    console.log("success1c: " + data_return.notice );
    imageCurrentIndex = data_return.new_image_index;
    oneImageName = data_return.name;
    oneImageFile = data_return.file;
    oneImageId = data_return.image_id;
    $('.image_display h2.up').append().html(oneImageName);
    var pathImage = "assets/pictures/" + oneImageFile;
    $(".img-center img").attr({alt: "Selected Image", src: pathImage, title: "Selected Image"});
  })
      .fail(function (data_return) {
        console.log("error: data_return = " + data_return);
      });
});

$('.img-left-side').click(function(event) {
  event.stopImmediatePropagation(); // would stop the event from bubbling to parent elements,
  $.ajax({
    type: "get",
    url: "api/next_image",
    data: { index: imageCurrentIndex,
      theme_id: selectedThemeId,
      length: themeImageSize},
    dataType: 'json'
  }).done(function (data_return){
    console.log("success1c: " + data_return.notice );
    imageCurrentIndex = data_return.new_image_index;
    oneImageName = data_return.name;
    oneImageFile = data_return.file;
    oneImageId = data_return.image_id;
    $('.image_display h2.up').append().html(oneImageName);
    var pathImage = "assets/pictures/" + oneImageFile;
    $(".img-center img").attr({alt: "Selected Image", src: pathImage, title: "Selected Image"});
  })
      .fail(function (data_return) {
        console.log("error: data_return = " + data_return);
      });
});